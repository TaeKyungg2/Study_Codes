
# 🧠 메모리 관련 Q&A 정리

---

## 1. C++에서 `new`로 만든 변수는 전역변수인가요?

- ❌ 아니요. `new`로 만든 변수는 **전역변수**가 아니라 **힙(heap)** 에 할당됩니다.
- 다만, **명시적으로 해제 (`delete`)하지 않으면 살아남기 때문에** 마치 전역처럼 "살아 있는 것처럼" 보일 수 있음.

---

## 2. 지역 변수에 포인터만 저장하면 되지, 왜 `new`를 쓰나요?

- 지역 변수는 함수 끝나면 사라져요.
- 예:  
  ```cpp
  int* ptr;  
  { int a = 10; ptr = &a; } // 여기서 a는 소멸되므로 ptr는 위험한 상태
  ```
- 반면 `new`로 할당한 메모리는 함수가 끝나도 살아 있으므로, **수명이 길어야 할 때는 `new`를 써야 해요.**

---

## 3. `new`로 만든 포인터도 지역에서 만들면 소멸되지 않나요?

- 포인터 변수 **자체는 지역 변수**지만,
- `new`로 만든 **실제 데이터는 힙**에 있어서 수명이 길어요.
- 따라서 포인터가 사라져도 **실제 데이터는 메모리 누수가 생기면서 남아 있게 돼요** → `delete`로 반드시 지워야 함.

---

## 4. C++의 `vector`는 힙에 저장되나요? 자동으로 메모리 관리하나요?

- ✅ 맞습니다.
  - `std::vector`의 **내부 배열은 힙에 저장**돼요.
  - `vector<int> v = {1,2,3};` 라고 해도 내부는 `new`를 써서 동적 메모리를 할당함.
- ✅ 소멸자에서 자동으로 `delete` 되기 때문에 메모리 누수 걱정이 없음.

---

## 5. 파이썬 배열과 C 배열의 저장 방식은 어떻게 다르죠?

### 파이썬 리스트
- 리스트 자체는 **스택에 존재하는 주소 배열**
- 각 요소는 객체를 가리키는 **포인터** → 실제 값은 힙에 존재
- 리스트가 사라지면 Python의 **GC(Garbage Collector)** 가 객체도 정리

### C 배열
- 정적 배열 (`int arr[10]`) → **스택에 값 자체 저장** (함수 안이면)
- 동적 배열 (`int* arr = new int[10]`) → **힙에 값 저장**, 포인터는 스택
- 동적 배열은 수동 해제가 필요 (`delete[]`)

---

## 6. 함수 내 지역변수를 스택에 넣으면 인덱스로 어떻게 접근해요?

- 컴파일러는 함수마다 고정된 **스택 프레임 구조**를 만들어 사용합니다.
- 변수는 기준 주소 (`rbp`, `ebp`) 기준으로 **오프셋(offset)** 으로 접근합니다.
- 예:
  ```asm
  mov eax, [rbp - 4]  ; 변수 a
  mov ebx, [rbp - 8]  ; 변수 b
  ```

---

## 7. 오프셋(offset) 뜻이 뭐예요?

- offset = **기준 주소에서 몇 바이트 떨어졌는지**
- 예: `배열[2] = base + 2 * sizeof(type)`
- 어원은 `off`(떨어짐) + `set`(놓다) → "떨어진 위치"

---

## 8. 실제로 메모리에는 진짜 스택 구조가 있나요?

- ❌ 실제 메모리엔 스택 자료구조처럼 생긴 물리적 구조는 없습니다.
- ✅ 단지 **메모리를 스택처럼 사용하는 방식**을 취한 거예요 (LIFO 구조)
- 운영체제가 **스택 영역(stack segment)** 을 마련하고, CPU가 **스택 포인터 (`rsp`)** 로 관리합니다.

---

## 📌 추가 개념 요약

| 개념 | 설명 |
|------|------|
| **스택** | 빠르고 간단한 메모리 영역. 함수 호출 시 지역 변수 저장. 자동 해제. |
| **힙** | 개발자가 직접 `new`, `malloc`으로 할당. 수명 제어 가능. 수동 해제 필요. |
| **오프셋(offset)** | 기준 주소에서 몇 바이트 떨어졌는지를 나타냄. 배열, 구조체, 지역 변수 등에 활용. |
| **vector** | 내부적으로 힙 메모리를 사용하는 자동 관리 배열 |
| **파이썬 리스트** | 스택에 주소 배열, 실제 값은 힙에 존재. 참조 기반. GC로 자동 해제 |
